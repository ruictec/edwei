webpackJsonp([22],{"2PQz":function(e,t){},VtiO:function(t,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=s("//Fk"),o=s.n(i),r=s("c2Ch"),n=(s("ktr9"),s("CXX0")),l=s("Mdwg"),c=s("WiOa"),u=s("nq2H"),d=s("T18w"),p=s("Umvz"),m=s("WMwB"),v=s("Mjwz"),h=s("zOBh"),f=s("czjk"),b=s("kZ1N"),g=s("2YZ9"),_=s("lUmj"),y=s("beD/"),w=s("lVyT"),x=s("8cSO"),$=s("ItK/"),k=s("0Fy/"),L=s("yGLh"),C=s("3zDK"),D={name:"LocationOutdoor",data:function(){return{i8n:this.$store.state.i18n,openlayersSource:"",contrForPrionum:this.$store.state.userInfo.prionum,tenantid_A:this.$store.state.userInfo.tenantid,tenantkey_A:this.$store.state.userInfo.tenantkey,userName:this.$store.state.userInfo.username,intoProjectType:this.$store.state.intoProjectType,userList:[],tboxList:[],searchList:{deveui:"",projectid:this.$store.state.projectid,devtype:"",postype:2},sostype:!1,map:"",seeLayer:"",view:"",mapName:"map",vectorLayer:null,source:null,imgMsg:"",edit:!1,building:0,mapInfo:"",buildingNameList:[],editData:{building:"",src:"",id:"",lati:"",longi:"",projectid:""},arrs:[],editFeatureInfo:"",oldEditBUilding:"",menu_overlay:"",zoom:this.$store.state.mapZoom,longi:this.$store.state.longis,lati:this.$store.state.latis,perDeveui:"",tboxDeveui:"",wsuri:C.a.ws+"map/"+this.$store.state.projectid,userLoading:!1,tboxLoading:!1,userOptions:[],tboxOptions:[],visible:!1,devPer:!1,showBracelet:!1,devTBox:!1,devAsset:!1,bracelet_eui:"",bracelet_soc:"",bracelet_rate:"",bracelet_tem:"",bracelet_oxygen:"",bracelet_time:"",age:"",depart:"",cardno:"",maplabel:"",sexstr:"",tel:"",worktype:"",username:"",imagePath:"",gpstime:"",imageAsset:"",assetName:"",assetType:"",assetModel:"",assetBeaconid:"",assetDepart:"",assetUser:"",assetTime:"",imageTBox:"",tboxName:"",tboxType:"",tboxMaplabel:"",tboxTime:"",mapCenter:[],xinaoList:[],AllFences:[],vectorSource:null,fences:[],popupOverlay:null,popupCloser:null,nameNum:"",showNameNum:!1,numData:[],whiteType:"",whiteNum:0,blackNum:0,whiteNotNum:0,fenceId:"",battery:""}},methods:{goStaff:function(e){this.$router.push({path:"/staff/staffmanagement",query:{username:e}})},goDevs:function(e){this.$router.push({path:"/device/terminal",query:{deveui:e}})},goBeacons:function(e){this.$router.push({path:"/device/beacon",query:{beaconid:e}})},ages:function(e){if(""==e||null==e)return 0;var t=e.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(null==t)return 0;var a=new Date(t[1],t[3]-1,t[4]);return a.getFullYear()==t[1]&&a.getMonth()+1==t[3]&&a.getDate()==t[4]?(new Date).getFullYear()-t[1]:0},goHis:function(){this.$router.push({path:"/location/outdoor/historical"})},clearInfo:function(){this.imageTBox="",this.imagePath="",this.username="",this.age="",this.sexstr="",this.tel="",this.maplabel="",this.cardno="",this.worktype="",this.depart="",this.gpstime="",this.imageAsset="",this.assetName="",this.assetType="",this.assetModel="",this.assetBeaconid="",this.assetDepart="",this.assetUser="",this.assetTime="",this.tboxName="",this.tboxType="",this.tboxMaplabel="",this.tboxTime=""},searchInfo:function(e,t){var a=this,s=this;if(s.websock&&s.websock.close(),this.perDeveui&&this.tboxDeveui)this.$message({message:this.$t("locationoutdoor.text2"),type:"warning"});else if(this.perDeveui&&(this.tboxDeveui="",this.searchList.deveui=this.perDeveui,1==s.intoProjectType?s.searchList.devtype=1:2==s.intoProjectType&&(s.searchList.devtype=2)),this.tboxDeveui&&(this.perDeveui="",this.searchList.deveui=this.tboxDeveui,this.searchList.devtype=4),e&&(this.searchList.deveui=e,1==s.intoProjectType?s.searchList.devtype=1:2==s.intoProjectType&&(s.searchList.devtype=2)),t&&(this.searchList.deveui=t,this.searchList.devtype=4),this.searchList.deveui)if("true"==s.$route.query.warning){var i=s.$store.state.sosData;e&&(s.remoteUserMethod(i.deveui),setTimeout(function(){s.tboxDeveui="",s.perDeveui=i.deveui},201),s.delFeature(i),setTimeout(function(){s.addIconMarker(s.map,i,!0);var e=Object(L.d)([i.x,i.y]);s.map.getView().setCenter(e)},100)),t&&(s.remoteTBoxMethod(i.deveui),setTimeout(function(){s.perDeveui="",s.tboxDeveui=i.deveui},201),s.delFeature(i),setTimeout(function(){s.addTBoxIconMarker(s.map,i,!0);var e=Object(L.d)([i.x,i.y]);s.map.getView().setCenter(e)},100))}else Object(r._44)(this.searchList,this.tenantkey_A,this.tenantid_A,this.userName).then(function(i){if(1001==i.code){if(e&&(s.remoteUserMethod(i.data.deveui),setTimeout(function(){s.perDeveui=i.data.deveui},201)),t&&(s.remoteTBoxMethod(i.data.deveui),setTimeout(function(){s.tboxDeveui=i.data.deveui},201)),null==i.data.gpstime||""==i.data.gpstime||0==i.data.gpstime)s.$message({message:a.$t("locationoutdoor.text4"),type:"warning"});else if(1==i.data.postype)s.$confirm(a.$t("locationoutdoor.text5"),a.$t("Building.tips"),{confirmButtonText:a.$t("terminal.confirm"),cancelButtonText:a.$t("terminal.cancel"),type:"warning",callback:function(e){"confirm"===e&&(s.perDeveui?s.$router.push({path:"/location/indoor/locationindoor",query:{deveui:i.data.deveui}}):s.tboxDeveui&&s.$router.push({path:"/location/indoor/locationindoor",query:{tboxDeveui:i.data.deveui}}))}});else if(2==i.data.postype){s.websock&&s.websock.close(),s.delFeature(i.data),s.perDeveui||e?s.addIconMarker(s.map,i.data,!0):(s.tboxDeveui||t)&&s.addTBoxIconMarker(s.map,i.data,!0);var o=Object(L.d)([i.data.x,i.data.y]);s.map.getView().setCenter(o),s.wsuri=C.a.ws+"map/"+s.searchList.deveui,s.initWebsocketOne()}}else a.$message({message:"zh"==s.$store.state.i18n?i.msg:i.enMsg,type:"error"})});else this.$message({message:this.$t("locationoutdoor.text3"),type:"warning"})},clearBtn:function(){var t=this;this.perDeveui="",this.tboxDeveui="",this.searchList={deveui:"",projectid:this.$store.state.projectid,devtype:"",postype:2},this.initWebsocket(),this.getMemberNames(),this.getTboxSnIds(),this.sostype=!1;var a=this,s=void 0;this.map&&(s=a.map.getLayers().getArray()),s.forEach(function(a){a instanceof $.b?a.getSource().getFeatures().length>0&&e.deveui==a.getSource().getFeatures()[0].values_.deveui&&(a.getSource().getFeatures().forEach(function(e){a.getSource().removeFeature(e)}),t.map.removeLayer(a)):a instanceof f.a||l.a});var i={projectid:this.$store.state.projectid,gpstype:2};Object(r._60)(i,this.tenantkey_A,this.tenantid_A,this.userName).then(function(e){1001==e.code&&(a.mapInfo=e.data,setTimeout(function(){if(t.mapInfo.length>0)for(var e=0;e<a.mapInfo.length;e++)a.addIconMarkers(a.map,a.mapInfo[e])},0))})},showAllFence:function(){var e=this,t=this;return new o.a(function(a){var s={projectid:e.$store.state.projectid};Object(r._49)(s,e.tenantkey_A,e.tenantid_A,e.userName).then(function(e){if(1001==e.code){var s=[];e.data.forEach(function(e){var t=[];e.list.forEach(function(e){t.push([e.pointX,e.pointY])}),s.push({coordinates:t,color:e.colour,id:e.id,num:e.num})}),t.AllFences=s}a()})})},hexToRgba:function(e,t){var a=parseInt(e.slice(1),16);return"rgba("+(a>>16&255)+", "+(a>>8&255)+", "+(a>>0&255)+", "+t+")"},recreateFences:function(){var e=this;this.vectorSource.clear(),this.AllFences.forEach(function(t){var a=t.coordinates,s=t.color,i=a.map(function(e){return Object(L.d)(e)}),o=new w.c([i]),r=new u.a({geometry:o,type:"fence",id:t.id,number:t.num}),n=new u.a({geometry:o.getInteriorPoint(),number:t.num,type:"number",id:t.id});r.setStyle(new y.e({fill:new _.a({color:e.hexToRgba(s,.5)}),stroke:new y.d({color:s,width:2})})),n.setStyle(new y.e({text:new g.a({text:String(t.num)+e.$t("warning.people"),font:"24px Calibri,sans-serif",fill:new _.a({color:"black"}),stroke:new y.d({color:"white",width:2})})})),e.vectorSource.addFeature(r),e.vectorSource.addFeature(n),e.fences.push({fenceFeature:r,numberFeature:n})})},updateNumber:function(e,t){if(this.fences&&this.fences[e]){null!==t&&void 0!==t||(t=0);var a=this.fences[e].numberFeature,s=this.fences[e].fenceFeature;a.set("number",t),s.set("number",t),a.getStyle().getText().setText(String(t)+this.$t("warning.people")),this.vectorSource.changed()}},initMap:function(){var e=this;e.vectorSource=new x.a,e.seeLayer=[new l.a({className:"baseLayerClass",source:e.openlayersSource}),new $.b({source:e.vectorSource})],e.mapInfo.length>0?e.view=new n.b({center:Object(L.d)([e.longi,e.lati]),zoom:15}):e.view=new n.b({center:Object(L.d)(e.mapCenter),zoom:15}),setTimeout(function(){if(e.map=new n.a({target:"map",layers:e.seeLayer,view:e.view}),e.map.addControl(new k.a),e.mapInfo.length>0)for(var t=0;t<e.mapInfo.length;t++)e.addIconMarkers(e.map,e.mapInfo[t]);e.mapClick(),e.addLine(e.map),e.initializePopup(e.map),e.showAllFence().then(function(){e.recreateFences()})},0)},getDevGpsLists:function(){var e=this;Object(r._43)({projectid:this.$store.state.projectid},this.tenantkey_A,this.tenantid_A,this.userName).then(function(t){if(1001==t.code){e.xinaoList=t.data.list;for(var a=0;a<e.xinaoList.length;a++)e.addIconMarkers(e.map,e.xinaoList[a])}})},addIconMarkers:function(e,t){if(0!=t.x||0!=t.y){var a=Object(L.d)([t.x,t.y]),s=new u.a({longi:t.x,lati:t.y,projectid:t.projectid,deveui:t.deveui,username:t.username,gpstime:t.gpstime,devtype:t.devtype,battery:t.battery?t.battery:"",geometry:new d.a(a)});this.source=new m.a({features:[s]});var i=void 0;i=4==t.devtype?"../../../static/tbox.png":3==t.devtype?"../../../static/beacon1.png":"../../../static/user1.png";var o=new v.c({image:new h.a({anchor:[.5,1],src:i,scale:1}),text:new g.a({text:t.username,font:"12px font-size",fill:new _.a({color:"white"}),offsetY:10})});this.vectorLayer=new p.a({source:this.source,style:o}),e.addLayer(this.vectorLayer)}},addIconMarker:function(e,t,a){var s=Object(L.d)([t.x,t.y]),i=new u.a({longi:t.x,lati:t.y,projectid:t.projectid,deveui:t.deveui,username:t.username,gpstime:t.gpstime,devtype:t.devtype,battery:t.battery?t.battery:"",geometry:new d.a(s)});this.source=new m.a({features:[i]});var o=void 0;if(o=this.sostype?new v.c({image:new h.a({anchor:[.5,1],src:"../../../static/usersos.png",scale:1}),text:new g.a({text:t.username,font:"12px font-size",fill:new _.a({color:"white"}),offsetY:10})}):new v.c({image:new h.a({anchor:[.5,1],src:"../../../static/user1.png",scale:1}),text:new g.a({text:t.username,font:"12px font-size",fill:new _.a({color:"white"}),offsetY:10})}),this.vectorLayer=new p.a({source:this.source,style:o}),e.addLayer(this.vectorLayer),this.sostype=!1,a){var r=Object(L.d)([t.x,t.y]);this.map.getView().setCenter(r)}},addAssetMarker:function(e,t){var a=Object(L.d)([t.x,t.y]),s=new u.a({longi:t.x,lati:t.y,projectid:t.projectid,deveui:t.deveui,username:t.username,gpstime:t.gpstime,devtype:t.devtype,geometry:new d.a(a)});this.source=new m.a({features:[s]});var i=new v.c({image:new h.a({anchor:[.5,1],src:"../../../static/beacon1.png",scale:1}),text:new g.a({text:t.username,font:"12px font-size",fill:new _.a({color:"white"}),offsetY:10})});this.vectorLayer=new p.a({source:this.source,style:i}),e.addLayer(this.vectorLayer),this.sostype=!1},addTBoxIconMarker:function(e,t,a){var s=Object(L.d)([t.x,t.y]),i=new u.a({longi:t.x,lati:t.y,projectid:t.projectid,deveui:t.deveui,username:t.username,gpstime:t.gpstime,devtype:t.devtype,battery:t.battery?t.battery:"",geometry:new d.a(s)});this.source=new m.a({features:[i]});var o=void 0;if(o=this.sostype?new v.c({image:new h.a({anchor:[.5,1],src:"../../../static/tboxsos.png",scale:1}),text:new g.a({text:t.username,font:"12px font-size",fill:new _.a({color:"white"}),offsetY:10})}):new v.c({image:new h.a({anchor:[.5,1],src:"../../../static/tbox.png",scale:1}),text:new g.a({text:t.username,font:"12px font-size",fill:new _.a({color:"white"}),offsetY:10})}),this.vectorLayer=new p.a({source:this.source,style:o}),e.addLayer(this.vectorLayer),this.sostype=!1,a){var r=Object(L.d)([t.x,t.y]);this.map.getView().setCenter(r)}},datetimecut:function(e){if(!e)return"-";function t(e){return e>9?e:"0"+e}var a=new Date(e);return a.getFullYear()+"-"+t(a.getMonth()+1)+"-"+t(a.getDate())+" "+(a.getHours()<10?"0"+a.getHours():a.getHours())+":"+t(a.getMinutes())+":"+t(a.getSeconds())},formatDate:function(e){if(null==e||0==e)return"";var t=new Date(1e3*parseInt(e)).toUTCString();return this.datetimecut(t)},mapClick:function(){var e=this,t=this;this.map.on("click",function(a){var s=e.map.forEachFeatureAtPixel(a.pixel,function(e){return a.coordinate,e});if(t.battery="",s){if(1==s.values_.devtype||2==s.values_.devtype){var i={maplabel:s.values_.deveui};Object(r._65)(i,t.tenantkey_A,t.tenantid_A,t.userName).then(function(e){1001==e.code?(t.battery=s.values_.battery,t.devPer=!0,t.devTBox=!1,t.devAsset=!1,t.age=t.ages(e.data.member.birthday),t.depart=e.data.member.depart,t.cardno=e.data.member.cardno,t.maplabel=e.data.member.maplabel,t.sexstr="zh"==t.i8n?e.data.member.sexstr:e.data.member.ensex,t.tel=e.data.member.tel,t.worktype=e.data.member.worktype,t.username=e.data.member.username,t.gpstime=t.formatDate(s.values_.gpstime),t.imagePath=e.data.member.filename?C.a.host+"profile/"+e.data.member.filename:"1"==e.data.member.sex?"../../../static/male.png":"2"==e.data.member.sex?"../../../static/female.png":"../../../static/nosex.png",null==e.data.devHealth?(t.bracelet_eui="",t.bracelet_soc="",t.bracelet_rate="",t.bracelet_tem="",t.bracelet_oxygen="",t.bracelet_time="",t.showBracelet=!1):(t.bracelet_eui=e.data.devHealth.wristEui,t.bracelet_soc=e.data.devHealth.soc,t.bracelet_rate=e.data.devHealth.heartrate,t.bracelet_tem=e.data.devHealth.tem,t.bracelet_oxygen=e.data.devHealth.oxygen,t.bracelet_time=t.formatDate(e.data.devHealth.dataTime),t.showBracelet=!0),t.visible=!0):t.$message({message:"zh"==t.$store.state.i18n?e.msg:e.enMsg,type:"error"})})}else if(4==s.values_.devtype){var o={maplabel:s.values_.deveui};Object(r._94)(o,t.tenantkey_A,t.tenantid_A,t.userName).then(function(e){1001==e.code?(t.battery=s.values_.battery,t.devPer=!1,t.showBracelet=!1,t.devTBox=!0,t.devAsset=!1,t.tboxName=e.data.sn,t.tboxType=e.data.type,t.tboxMaplabel=e.data.maplabel,t.tboxTime=t.formatDate(s.values_.gpstime),t.imageTBox=C.a.host+"profile/"+e.data.filename,t.visible=!0):t.$message({message:"zh"==t.$store.state.i18n?e.msg:e.enMsg,type:"error"})})}else if(3==s.values_.devtype){var n={beaconid:s.values_.deveui};Object(r._16)(n,t.tenantkey_A,t.tenantid_A,t.userName).then(function(e){1001==e.code?(t.devPer=!1,t.showBracelet=!1,t.devAsset=!0,t.devTBox=!1,t.assetName=e.data.name,t.assetType=e.data.type,t.assetModel=e.data.model,t.assetBeaconid=e.data.beaconid,t.assetDepart=e.data.depart,t.assetUser=e.data.username,t.assetTime=t.formatDate(s.values_.gpstime),t.imageAsset=C.a.host+"profile/"+e.data.filename,t.visible=!0):t.$message({message:"zh"==t.$store.state.i18n?e.msg:e.enMsg,type:"error"})})}if("fence"===s.get("type")||"number"===s.get("type")){t.fenceId=s.get("id");var l=s.get("number");l>0?t.showPopup(a.coordinate,t.fenceId,l):t.$message({message:t.$t("terminal.nodata"),type:"info"})}}})},initializePopup:function(e){var t=document.getElementById("popup-num"),a=document.getElementById("popup-closer-num");this.popupCloser=a,this.popupOverlay=new b.a({element:t,autoPan:{animation:{duration:250}}}),e.addOverlay(this.popupOverlay)},showPopup:function(e,t,a){var s=this,i=this,o=60*-(new Date).getTimezoneOffset(),n={projectid:this.$store.state.projectid,id:t,timezone:o};Object(r._51)(n,this.tenantkey_A,this.tenantid_A,this.userName).then(function(t){if(1001==t.code){i.whiteNum=t.data.whiteNum,i.whiteNotNum=t.data.totalNum-t.data.whiteNum,i.blackNum=a-t.data.whiteNum,i.whiteType=t.data.whiteType;var o='\n          <table class="popup-table">\n            <tr>\n              <td class="popup-cell" data-category="1"> '+s.$t("locationoutdoor.Whitelist")+'</td>\n              <td class="popup-cell" data-category="2">'+s.$t("locationoutdoor.Nonwhitelist")+'</td>\n              <td class="popup-cell" data-category="3">'+s.$t("locationoutdoor.Whitelistnotin")+'</td>\n            </tr>\n            <tr>\n              <td class="popup-cell" data-category="1">'+i.whiteNum+'</td>\n              <td class="popup-cell" data-category="2">'+i.blackNum+'</td>\n              <td class="popup-cell" data-category="3">'+i.whiteNotNum+"</td>\n            </tr>\n          </table>\n        ";i.$nextTick(function(){document.querySelectorAll(".popup-cell").forEach(function(e){e.addEventListener("click",i.handleClick)})}),s.popupOverlay.setPosition(e),document.getElementById("popup-content-num").innerHTML=o}else i.$message({message:"zh"==i.$store.state.i18n?t.msg:t.enMsg,type:"error"})})},handleClick:function(e){var t=this,a=e.target.dataset.category,s={id:t.fenceId,projectid:t.$store.state.projectid,whiteType:t.whiteType,dataType:""};switch(a){case"1":if(0==t.whiteNum)return void t.$message({message:t.$t("terminal.nodata"),type:"info"});s.dataType=1,t.nameNum=t.$t("locationoutdoor.Whitelist");break;case"2":if(0==t.blackNum)return void t.$message({message:t.$t("terminal.nodata"),type:"info"});s.dataType=2,t.nameNum=t.$t("locationoutdoor.Nonwhitelist");break;case"3":if(0==t.whiteNotNum)return void t.$message({message:t.$t("terminal.nodata"),type:"info"});s.dataType=3,t.nameNum=t.$t("locationoutdoor.Whitelistnotin")}Object(r._50)(s,this.tenantkey_A,this.tenantid_A,this.userName).then(function(e){1001==e.code?(t.showNameNum=!0,t.numData=e.data):t.$message({message:"zh"==t.$store.state.i18n?e.msg:e.enMsg,type:"error"})})},closePopup:function(e){e.preventDefault(),this.popupOverlay.setPosition(void 0),this.popupCloser.blur()},addLine:function(e){var t=new y.e({stroke:new y.d({color:"#AA8DC6",width:10})}),a=new w.a([[122.9272781486751,23.848426854398152],[122.40150850225844,22.133416341086654],[121.78811058143899,21.35728019637634],[120.18576499235964,19.5296047588327],[119.25521102926318,17.337282710181967],[119.05017371536066,14.734886033725882],[118.98708531108292,12.810689703255191],[118.07230344905598,10.88649337278446],[116.57395384745995,8.96229704231377],[111.37587218970845,3.8613280294327694],[110.27425959721639,2.809788736599442],[107.95320447327722,5.7617448175673145],[107.26213818712276,7.806878264206475],[108.44658415967254,8.693401446500248],[110.07396639858125,11.021809880631187],[110.90017584295029,13.225035065615302],[109.69841665114078,15.428260250599415],[107.99592446274401,17.531338836266087]]),s=new x.a({wrapX:!1}),i=new y.e({stroke:new y.d({color:[170,141,198,1],lineDash:[2,7]})});var o=new u.a({geometry:a,finished:!1,dashOffset:-8});function r(){return[i,new y.e({stroke:new y.d({color:[170,141,198,1],widht:5,lineDash:[2,7],lineDashOffset:o.get("dashOffset")})})]}o.setStyle(r()),s.addFeature(o);var n=new $.b({source:s,style:t});e.addLayer(n),setInterval(function(){var e=o.get("dashOffset");e=0==e?-8:e+1,o.set("dashOffset",e),o.setStyle(r())},100)},editFeature:function(e,t){this.menu_overlay=t,this.editData.building=e.values_.building,this.editData.src=e.values_.src,this.editData.id=e.values_.id,this.editData.lati=e.values_.lati,this.editData.longi=e.values_.longi,this.editData.projectid=e.values_.projectid,this.oldEditBUilding=e.values_.building,this.editFeatureInfo=e,this.edit=!0},editCancel:function(){this.edit=!1,this.oldEditBUilding=""},editTrue:function(){var e=this;this.buildingNameList.indexOf(this.editData.building)>-1?this.$message({message:this.editData.building+"已存在",type:"warning"}):(this.editFeatureInfo.values_.building=this.editData.building,this.editFeatureInfo.values_.src=this.editData.src,this.editFeatureInfo.values_.id=this.editData.id,this.editFeatureInfo.values_.lati=this.editData.lati,this.editFeatureInfo.values_.longi=this.editData.longi,this.editFeatureInfo.values_.projectid=this.editData.projectid,e.edit=!1,this.buildingNameList=this.buildingNameList.filter(function(t){return t!=e.oldEditBUilding}),this.buildingNameList.push(this.editData.building),e.editFeatureInfo.setStyle(new v.c({image:new h.a({anchor:[.5,1],src:e.editData.src,scale:1}),text:new g.a({text:e.editData.building,font:"12px font-size",fill:new _.a({color:"white"}),offsetY:10})})),e.menu_overlay.setPosition(void 0))},delFeature:function(e){var t=this,a=void 0;this.map&&(a=this.map.getLayers().getArray()),a.forEach(function(a){a instanceof $.b?a.getSource().getFeatures().length>0&&e.deveui==a.getSource().getFeatures()[0].values_.deveui&&(a.getSource().getFeatures().forEach(function(e){a.getSource().removeFeature(e)}),t.map.removeLayer(a)):a instanceof f.a||l.a})},getAllFeatures:function(){var e=this.map.getLayers().getArray();this.arrs=[];for(var t=void 0,a=1;a<e.length;a++)e[a].getSource().getFeatures()[0].values_.building&&(t={building:e[a].getSource().getFeatures()[0].values_.building,longi:e[a].getSource().getFeatures()[0].values_.longi,lati:e[a].getSource().getFeatures()[0].values_.lati,src:e[a].getSource().getFeatures()[0].values_.src,id:e[a].getSource().getFeatures()[0].values_.id},this.arrs.push(t))},getDevGpsLocation:function(){var e=this,t={projectid:this.$store.state.projectid,gpstype:2};Object(r._60)(t,this.tenantkey_A,this.tenantid_A,this.userName).then(function(t){1001==t.code&&(e.mapInfo=t.data,e.initMap())})},getMemberNames:function(){var e=this,t={projectid:this.$store.state.projectid};Object(r._68)(t,this.tenantkey_A,this.tenantid_A,this.userName).then(function(t){if(1001==t.code){e.userList=t.data.map(function(e){return{value:""+e.maplabel,maplabel:""+e.maplabel,username:""+e.username}});for(var a=e.userList.length-1;a>-1;a--)""!=e.userList[a].maplabel&&null!=e.userList[a].maplabel&&void 0!=e.userList[a].maplabel||e.userList.splice(a,1)}})},getTboxSnIds:function(){var e=this,t={projectid:this.$store.state.projectid};Object(r._95)(t,this.tenantkey_A,this.tenantid_A,this.userName).then(function(t){1001==t.code&&(e.tboxList=t.data.filter(function(e){return e.maplabel}).map(function(e){return{value:""+e.maplabel,maplabel:""+e.maplabel,sn:""+e.sn}}))})},remoteUserMethod:function(e){var t=this;""!==e?(this.userLoading=!0,setTimeout(function(){t.userLoading=!1,t.userOptions=t.userList.filter(function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>-1?t.value.toLowerCase().indexOf(e.toLowerCase())>-1:t.username.toLowerCase().indexOf(e.toLowerCase())>-1?t.username.toLowerCase().indexOf(e.toLowerCase())>-1:void 0})},200)):this.userOptions=[]},remoteTBoxMethod:function(e){var t=this;""!==e?(this.tboxLoading=!0,setTimeout(function(){t.tboxLoading=!1,t.tboxOptions=t.tboxList.filter(function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>-1?t.value.toLowerCase().indexOf(e.toLowerCase())>-1:t.sn.toLowerCase().indexOf(e.toLowerCase())>-1?t.sn.toLowerCase().indexOf(e.toLowerCase())>-1:void 0})},200)):this.tboxOptions=[]},initWebsocket:function(){if("undefined"==typeof WebSocket)return alert("您的浏览器不支持WebSocket"),!1;this.websock=new WebSocket(this.wsuri),this.websock.onopen=this.websocketopen,this.websock.onmessage=this.websocketonmessage,this.websock.onerror=this.websocketerror,this.websock.onclose=this.close},initWebsocketOne:function(){if("undefined"==typeof WebSocket)return alert("您的浏览器不支持WebSocket"),!1;this.websock=new WebSocket(this.wsuri),this.websock.onopen=this.websocketopenOne,this.websock.onmessage=this.websocketonmessage,this.websock.onerror=this.websocketerrorOne,this.websock.onclose=this.close},websocketopen:function(e){},websocketopenOne:function(e){},websocketonmessage:function(e){var t=this;if("连接成功"!=e.data){var a=JSON.parse(e.data);a.deveui&&(t.delFeature(a),a.fenceObj.length>0&&a.fenceObj.forEach(function(e){if(e.num>0){var a=t.AllFences.findIndex(function(t){return t.id===e.id});t.updateNumber(a,e.num)}}),2!=a.status&&(4==a.devtype?t.addTBoxIconMarker(t.map,a):3==a.devtype?t.addAssetMarker(t.map,a):t.addIconMarker(t.map,a)))}},close:function(e){this.websock.close()},websocketerror:function(){},websocketerrorOne:function(){},websocketSend:function(e){this.websock.send(e)},updateSize:function(){this.map.updateSize()}},beforeMount:function(){var e=this;this.$store.state.longis&&this.$store.state.latis?this.mapCenter=[this.$store.state.longis,this.$store.state.latis]:"zh"==this.$store.state.i18n?this.mapCenter=[118,32]:this.mapCenter=[.1,51.3],"zh"==this.$store.state.i18n?this.openlayersSource=new c.b({url:"https://www.edwei.cn:8443/osm/{z}/{x}/{y}.png",crossOrigin:""}):this.openlayersSource=new c.b,this.$route.query.deveui?("true"==this.$route.query.sostype?this.sostype=!0:this.sostype=!1,this.initMap(),setTimeout(function(){e.searchInfo(e.$route.query.deveui)},0)):this.$route.query.tboxDeveui?("true"==this.$route.query.sostype?this.sostype=!0:this.sostype=!1,this.initMap(),setTimeout(function(){e.searchInfo("",e.$route.query.tboxDeveui)},0)):(this.sostype=!1,this.getDevGpsLocation(),this.initWebsocket()),this.getMemberNames(),this.getTboxSnIds()},computed:{show1:function(){return this.$store.state.show}},watch:{show1:function(e){var t=this;setTimeout(function(){t.updateSize()},200)},"$i18n.locale":function(){this.i8n=this.$store.state.i18n},$route:{handler:function(e,t){var a=this;e.query!=t.query&&(this.getMemberNames(),this.getTboxSnIds(),this.$route.query.deveui?("true"==this.$route.query.sostype?this.sostype=!0:this.sostype=!1,setTimeout(function(){a.searchInfo(a.$route.query.deveui)},10)):this.$route.query.tboxDeveui?setTimeout(function(){a.searchInfo("",a.$route.query.tboxDeveui)},10):(this.sostype=!1,this.getDevGpsLocation(),this.initWebsocket()))}}},destroyed:function(){this.websock.close()}},T={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[a("div",{staticClass:"inputContent"},[a("el-form",{staticClass:"demo-form-inline",staticStyle:{display:"flex","white-space":"nowrap","margin-left":"0%"},attrs:{model:e.searchList}},[a("el-form-item",{staticStyle:{display:"flex","margin-left":"0%","margin-right":"2%"},attrs:{label:e.$t("staffmanagement.username1")}},[a("el-select",{staticStyle:{width:"120%"},attrs:{clearable:"",filterable:"",remote:"","remote-method":e.remoteUserMethod,placeholder:e.$t("staffmanagement.text")},model:{value:e.perDeveui,callback:function(t){e.perDeveui=t},expression:"perDeveui"}},e._l(e.userOptions,function(t){return a("el-option",{key:t.maplabel,attrs:{label:t.username,value:t.maplabel}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.username))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.maplabel))])])}),1)],1),e._v(" "),1==e.intoProjectType?a("el-form-item",{staticStyle:{display:"flex","margin-left":"1%","margin-right":"2%"},attrs:{label:e.$t("car.Numberplate")}},[a("el-select",{staticStyle:{width:"120%"},attrs:{clearable:"",filterable:"",remote:"","remote-method":e.remoteTBoxMethod,placeholder:e.$t("staffmanagement.text")},model:{value:e.tboxDeveui,callback:function(t){e.tboxDeveui=t},expression:"tboxDeveui"}},e._l(e.tboxOptions,function(t){return a("el-option",{key:t.maplabel,attrs:{label:t.sn,value:t.maplabel}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.sn))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.maplabel))])])}),1)],1):e._e(),e._v(" "),a("el-form-item",{staticStyle:{display:"flex","margin-left":"2%"}},[a("el-button",{staticClass:"query",attrs:{type:"primary"},on:{click:function(t){return e.searchInfo()}}},[e._v(e._s(e.$t("floormanagement.search")))]),e._v(" "),a("el-button",{staticClass:"reset",attrs:{type:"primary"},on:{click:function(t){return e.clearBtn()}}},[e._v(e._s(e.$t("floormanagement.reset")))]),e._v(" "),a("el-button",{staticClass:"reset",attrs:{type:"primary"},on:{click:function(t){return e.goHis()}}},[e._v(e._s(e.$t("Breadcrumb.Historicaltrack")))])],1)],1)],1),e._v(" "),a("div",{staticClass:"mapConent"},[a("div",{attrs:{id:"map"}}),e._v(" "),a("div",{staticClass:"ol-popup-num",attrs:{id:"popup-num"}},[a("a",{staticClass:"ol-popup-closer-num",attrs:{href:"#",id:"popup-closer-num"},on:{click:e.closePopup}}),e._v(" "),a("div",{attrs:{id:"popup-content-num"}})])]),e._v(" "),a("el-dialog",{staticClass:"Info_dialog",attrs:{visible:e.visible,width:e.showBracelet?"25%":"20%",modal:!1},on:{"update:visible":function(t){e.visible=t},close:function(t){return e.clearInfo()}}},[a("div",{staticClass:"ol-popup",attrs:{id:"popup"}},[a("div",{attrs:{id:"popup-content"}},[a("ul",{directives:[{name:"show",rawName:"v-show",value:e.devPer,expression:"devPer"}],staticClass:"container"},[a("div",{staticClass:"left-top"},[a("el-image",{staticStyle:{width:"100%",height:"auto"},attrs:{src:e.imagePath}})],1),e._v(" "),a("div",{staticClass:"right-top"},[a("li",{staticClass:"goDev"},[e._v("\n              "+e._s(e.$t("locationoutdoor.name"))+"\n              "),a("a",{on:{click:function(t){return e.goStaff(e.username)}}},[e._v(e._s(e.username))])]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.age"))+e._s(e.age))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.sex"))+e._s(e.sexstr))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.worktype"))+e._s(e.worktype))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.department"))+e._s(e.depart))])],1),e._v(" "),e.showBracelet?a("div",{staticClass:"bottom"},[a("el-divider",{staticClass:"divider"}),e._v(" "),a("p",{staticClass:"bracelet_title"},[e._v("\n              "+e._s(e.$t("LocationIndoor.equipmentInfo"))+"\n            ")]),e._v(" "),a("li",{staticClass:"goDev bracelet_dev"},[a("span",[e._v(e._s(e.$t("terminal.deveui"))+"\n                "),a("a",{on:{click:function(t){return e.goDevs(e.maplabel)}}},[e._v(e._s(e.maplabel))])]),e._v(" "),e.battery?a("span",[e._v(e._s(e.$t("locationoutdoor.electricity"))+e._s(e.battery)+"%")]):e._e()]),e._v(" "),a("li",[e._v(e._s(e.$t("terminal.Locationupdatetime1"))+e._s(e.gpstime))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("p",{staticClass:"bracelet_title"},[e._v("\n              "+e._s(e.$t("LocationIndoor.braceletData"))+"\n            ")]),e._v(" "),a("li",{staticClass:"bracelet_dev"},[a("span",[e._v(e._s(e.$t("terminal.deveui"))+" "+e._s(e.bracelet_eui))]),e._v(" "),a("span",[e._v(e._s(e.$t("locationoutdoor.electricity"))+e._s(e.bracelet_soc)+"%")])]),e._v(" "),a("li",{staticClass:"bracelet_dev"},[a("span",[e._v(e._s(e.$t("LocationIndoor.heartRate"))+e._s(e.bracelet_rate))]),e._v(" "),a("span",[e._v(e._s(e.$t("LocationIndoor.temperature"))+e._s(e.bracelet_tem)+" °C")]),e._v(" "),a("span",[e._v(e._s(e.$t("LocationIndoor.oxygen"))+e._s(e.bracelet_oxygen))])]),e._v(" "),a("li",[e._v(e._s(e.$t("home.Dataupdatetime"))+e._s(e.bracelet_time))])],1):a("div",{staticClass:"bottom"},[a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.telephone"))+e._s(e.tel))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.cardno"))+e._s(e.cardno))]),e._v(" "),e.battery?a("el-divider",{staticClass:"divider"}):e._e(),e._v(" "),e.battery?a("li",[e._v("\n              "+e._s(e.$t("locationoutdoor.electricity"))+e._s(e.battery)+" %\n            ")]):e._e(),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",{staticClass:"goDev"},[e._v("\n              "+e._s(e.$t("terminal.deveui"))+"\n              "),a("a",{on:{click:function(t){return e.goDevs(e.maplabel)}}},[e._v(e._s(e.maplabel))])]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("terminal.Locationupdatetime1"))+e._s(e.gpstime))])],1)]),e._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:e.devAsset,expression:"devAsset"}],staticClass:"container"},[a("div",{staticClass:"left-top"},[a("el-image",{staticStyle:{width:"100%",height:"auto"},attrs:{src:e.imageAsset}})],1),e._v(" "),a("div",{staticClass:"right-top"},[a("li",[e._v(e._s(e.$t("locationoutdoor.AssetName"))+e._s(e.assetName))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.Assettype"))+e._s(e.assetType))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.Assetmodel"))+e._s(e.assetModel))])],1),e._v(" "),a("div",{staticClass:"bottom"},[a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",{staticClass:"goDev"},[e._v("\n              "+e._s(e.$t("LocationIndoor.TagNo"))),a("a",{on:{click:function(t){return e.goBeacons(e.assetBeaconid)}}},[e._v(e._s(e.assetBeaconid))])]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.Department"))+e._s(e.assetDepart))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.User"))+e._s(e.assetUser))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.Time"))+e._s(e.assetTime))])],1)]),e._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:e.devTBox,expression:"devTBox"}]},[a("el-image",{staticStyle:{width:"150px",height:"150px"},attrs:{src:e.imageTBox}}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.carnumber"))+e._s(e.tboxName))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.Vehicletype"))+e._s(e.tboxType))]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",{staticClass:"goDev"},[e._v("\n            "+e._s(e.$t("LocationIndoor.TagNo"))),a("a",{on:{click:function(t){return e.goDevs(e.tboxMaplabel)}}},[e._v(e._s(e.tboxMaplabel))])]),e._v(" "),a("el-divider",{staticClass:"divider"}),e._v(" "),a("li",[e._v(e._s(e.$t("locationoutdoor.time"))+e._s(e.tboxTime))]),e._v(" "),a("el-divider",{staticClass:"divider"})],1)])])]),e._v(" "),a("el-dialog",{staticClass:"edit",staticStyle:{"text-align":"center"},attrs:{title:e.$t("locationoutdoor.text"),visible:e.edit,width:"50%"},on:{"update:visible":function(t){e.edit=t}}},[a("el-form",{ref:"editData",staticStyle:{"text-align":"left"},attrs:{model:e.editData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:e.$t("locationoutdoor.floor")}},[a("el-input",{attrs:{placeholder:e.$t("locationoutdoor.text1")},model:{value:e.editData.building,callback:function(t){e.$set(e.editData,"building",t)},expression:"editData.building"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.editCancel()}}},[e._v(e._s(e.$t("warning.Cancel")))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editTrue()}}},[e._v(e._s(e.$t("warning.Sure")))])],1)],1),e._v(" "),a("el-dialog",{staticClass:"edit",staticStyle:{"text-align":"center"},attrs:{title:e.nameNum,visible:e.showNameNum,width:"50%"},on:{"update:visible":function(t){e.showNameNum=t}}},[a("el-table",{staticStyle:{width:"100"},attrs:{data:e.numData,"max-height":"660",stripe:""}},[a("el-table-column",{attrs:{property:"username",label:e.$t("staff.employeename"),"show-overflow-tooltip":"",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{property:"tel",label:e.$t("staff.telephone"),"show-overflow-tooltip":"",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{property:"worktype",label:e.$t("staff.Typeofwork"),"show-overflow-tooltip":"",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{property:"maplabel",label:e.$t("staff.Workcardnumber"),"show-overflow-tooltip":"",align:"center"}})],1)],1)],1)},staticRenderFns:[]};var N=s("VU/8")(D,T,!1,function(e){s("YGSZ"),s("2PQz")},"data-v-09bc2f0c",null);a.default=N.exports},YGSZ:function(e,t){}});