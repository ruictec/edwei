webpackJsonp([24],{"3AZ+":function(e,t,n){"use strict";(function(e){var o=n("PO8r"),s=n("3zDK"),i=n("c2Ch"),a=n("ktr9"),r=(n.n(a),n("czjk")),c=n("trid"),u=n("7rnj"),d=n("flqW"),l=n("Lfyu"),p=n("/LWt"),h=n("nq2H"),m=n("T18w"),f=n("Umvz"),v=n("WMwB"),y=n("Mjwz"),g=n("zOBh"),w=n("kZ1N"),k=(n("TDso"),n("2YZ9")),b=n("lUmj");t.a={components:{Menu:o.a},name:"LocationDeveui",data:function(){return{contrForPrionum:this.$store.state.userInfo.prionum,tenantid_A:this.$store.state.userInfo.tenantid,tenantkey_A:this.$store.state.userInfo.tenantkey,userName:this.$store.state.userInfo.username,intoProjectName:this.$store.state.intoProjectName,intoGroundImg:this.$store.state.intoGroundImg,intoGroundId:this.$store.state.intoGroundId,map:null,mapName:"allmap",modify:null,vectorLayer:null,source:null,feature:null,startX:"",startY:"",endX:"",endY:"",edit:!1,mapInfo:"",websock:"",wsuri:s.a.ws+"gps/"+this.$store.state.intoGroundId,searchList:{}}},methods:{getDevGpsLocation:function(){var e=this,t={groundid:this.intoGroundId,gpstype:1};Object(i._60)(t,this.tenantkey_A,this.tenantid_A,this.userName).then(function(t){if(1001==t.code){e.mapInfo=t.data;for(var n=0;n<e.mapInfo.length;n++)e.addIconMarkers(e.map,e.mapInfo[n])}})},searchInfo:function(){var e=this;Object(i._44)(this.searchList,this.tenantkey_A,this.tenantid_A,this.userName).then(function(t){1001==t.code&&(e.websock.close(),e.delFeature(t.data),e.addIconMarker(e.map,t.data,2),e.$message({message:e.$t("project.Searchsucceeded"),type:"success"}))})},clearBtn:function(){1==this.$store.state.intoProjectprojectType?this.searchList={projectid:this.$store.state.intoProjectid,deveui:"",devtype:1,postype:1}:2==this.$store.state.intoProjectprojectType&&(this.searchList={projectid:this.$store.state.intoProjectid,deveui:"",devtype:2,postype:1}),this.initWebsocket()},initWebsocket:function(){if("undefined"==typeof WebSocket)return alert("您的浏览器不支持WebSocket"),!1;this.websock=new WebSocket(this.wsuri),this.websock.onopen=this.websocketopen,this.websock.onmessage=this.websocketonmessage,this.websock.onerror=this.websocketerror,this.websock.onclose=this.close},websocketopen:function(){this.websocketSend(this.intoGroundId)},websocketonmessage:function(e){var t=JSON.parse(e.data);if(t.length>0)for(var n=0;n<t.length;n++)this.delFeature(t[n]),this.addIconMarker(this.map,t[n],1)},close:function(){},websocketerror:function(){},websocketSend:function(e){this.websock.send(e)},goProject:function(){this.$router.push("/projectmanagement")},mapint:function(e,t){var n=this,o=[0,0,e,t],i=new u.a({code:"xkcd-image",units:"pixels",extent:o});setTimeout(function(){var a=void 0,u=void 0;e>1399&&t>699?(a=1400,u=700):e>1399&&t<700?(a=1400,u=t):e<1400&&t>699?(u=700,a=e):e<1400&&t<700&&(a=e,u=t),n.$refs.map.style.width=a+"px",n.$refs.map.style.height=u+"px",n.map=new c.a({layers:[new r.a({source:new d.a({url:(s.a.host&&s.a.host.endsWith("/")?s.a.host:s.a.host+"/")+"indoormap/"+n.intoGroundImg,projection:i,imageExtent:o})})],target:n.mapName,view:new l.a({projection:i,center:Object(p.y)(o),zoom:2,maxZoom:6,extent:[0,0,e,t]})})},0)},mapRightClick:function(t){var n=this,o=new w.a({element:document.getElementById("contextmenu_container"),positioning:"center-center"});t.addOverlay(o),e(t.getViewport()).on("contextmenu",function(s){s.preventDefault();var i=t.getEventPixel(s.originalEvent),a=t.forEachFeatureAtPixel(i,function(e){return e});if(a&&a.values_.x){var r=t.getEventCoordinate(s.originalEvent);o.setPosition(r),e("#del").click(function(){n.delFeature(a,o)}),e("#edit").click(function(){n.editFeature(a,o)})}})},mapClick:function(){var t=this,n=this,o="",s="",i=document.getElementById("popup"),a=document.getElementById("popup-content"),r=(document.getElementById("popup-closer"),new w.a({element:i,autoPan:!0}));this.map.on("click",function(i){var c=t.map.forEachFeatureAtPixel(i.pixel,function(t){var o=i.coordinate;return a.innerHTML="<p>你点击的坐标为："+o+"</p>",r.setPosition(o),n.map.addOverlay(r),e("#popup-closer").on("click",function(e){e.preventDefault(),r.setPosition(void 0)}),t});if(c)c.get("x");else o=Number(i.coordinate[0]/1e3*100).toFixed(2),s=Number(i.coordinate[1]/1e3*100).toFixed(2),t.addIconMarker(t.map,o,s)})},addIconMarkers:function(e,t){var n=new h.a({x:t.x,y:t.y,deveui:t.deveui,geometry:new m.a([t.x,t.y])});this.source=new v.a({features:[n]});var o=new y.c({image:new g.a({anchor:[.5,1],src:"../../../static/User.png",scale:1}),text:new k.a({text:t.username,font:"12px font-size",fill:new b.a({color:"red"}),offsetY:10})});this.vectorLayer=new f.a({source:this.source,style:o}),e.addLayer(this.vectorLayer)},addIconMarker:function(e,t,n){var o=new h.a({x:t.x,y:t.y,deveui:t.deveui,geometry:new m.a([t.x,t.y])});this.source=new v.a({features:[o]});var s=new y.c({image:new g.a({anchor:[.5,1],src:"../../../static/User.png",scale:n}),text:new k.a({text:t.username,font:"12px font-size",fill:new b.a({color:"blue"}),offsetY:10})});this.vectorLayer=new f.a({source:this.source,style:s}),e.addLayer(this.vectorLayer)},delFeature:function(e){for(var t=this,n=this.map.getLayers().getArray(),o=function(o){e.deveui==n[o].getSource().getFeatures()[0].values_.deveui&&(n[o].getSource().getFeatures().forEach(function(e){n[o].getSource().removeFeature(e)}),t.map.removeLayer(n[o]))},s=1;s<n.length;s++)o(s)},editFeature:function(){this.edit=!0},saveBtn:function(){for(var e=this.map.getLayers().getArray(),t=[],n=void 0,o=1;o<e.length;o++)n={x:e[o].getSource().getFeatures()[0].values_.x,y:e[o].getSource().getFeatures()[0].values_.y},t.push(n)}},mounted:function(){this.mapint(this.$store.state.intoGroundImgWidth,this.$store.state.intoGroundImgHeight),this.initWebsocket(),this.getDevGpsLocation(),1==this.$store.state.intoProjectprojectType?this.searchList={projectid:this.$store.state.intoProjectid,deveui:"",devtype:1,postype:1}:2==this.$store.state.intoProjectprojectType&&(this.searchList={projectid:this.$store.state.intoProjectid,deveui:"",devtype:2,postype:1})},destroyed:function(){this.websock.close()}}}).call(t,n("7t+N"))},b0PQ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("3AZ+"),s={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("el-main",[n("div",{staticClass:"inputContent",staticStyle:{display:"flex"}},[n("el-form",{staticClass:"demo-form-inline",staticStyle:{display:"flex","white-space":"nowrap","margin-left":"0"},attrs:{model:e.searchList}},[n("el-form-item",{staticStyle:{display:"flex","margin-right":"0"},attrs:{label:e.$t("floormanagement.device")}},[n("el-select",{attrs:{clearable:"",filterable:"",placeholder:e.$t("terminal.choose")},model:{value:e.searchList.deveui,callback:function(t){e.$set(e.searchList,"deveui",t)},expression:"searchList.deveui"}},e._l(e.mapInfo,function(e){return n("el-option",{key:e.deveui,attrs:{label:e.deveui,value:e.deveui}})}),1)],1),e._v(" "),n("el-form-item",{staticStyle:{display:"flex","margin-left":"4%","margin-right":"2%"}},[n("el-button",{staticClass:"querry",attrs:{type:"primary"},on:{click:function(t){return e.searchInfo()}}},[e._v(e._s(e.$t("mapmanagements.search")))]),e._v(" "),n("el-button",{staticClass:"reset",attrs:{type:"primary"},on:{click:function(t){return e.clearBtn()}}},[e._v(e._s(e.$t("mapmanagements.reset")))])],1)],1)],1),e._v(" "),n("div",{staticClass:"mmm",staticStyle:{"margin-top":"0",height:"100%"}},[n("div",{ref:"map",attrs:{id:"allmap"}}),e._v(" "),n("div",{staticClass:"ol-popup",attrs:{id:"popup"}},[n("a",{staticClass:"ol-popup-closer",attrs:{href:"#",id:"popup-closer"}}),e._v(" "),n("div",{attrs:{id:"popup-content"}})])])])],1)},staticRenderFns:[]};var i=function(e){n("mLsU")},a=n("VU/8")(o.a,s,!1,i,"data-v-9cf03ba8",null);t.default=a.exports},mLsU:function(e,t){}});