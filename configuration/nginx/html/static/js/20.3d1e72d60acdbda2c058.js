webpackJsonp([20],{"6M01":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("woOf"),r=s.n(a),n=s("PO8r"),i=s("CTnB"),o=s("s0MJ"),l=s("c2Ch"),c=s("WiOa"),h=(s("ktr9"),s("nq2H")),u=s("trid"),m=s("Lfyu"),d=s("lVyT"),p=s("ItK/"),g=s("WMwB"),f=s("0Fy/"),w=s("beD/"),y={components:{Menu:n.a,Project:i.a},name:"LocationHistorical",data:function(){return{openlayersSource:"",contrForPrionum:this.$store.state.userInfo.prionum,tenantid_A:this.$store.state.userInfo.tenantid,tenantkey_A:this.$store.state.userInfo.tenantkey,userName:this.$store.state.userInfo.username,intoProjectType:this.$store.state.intoProjectType,searchList:{projectid:this.$store.state.projectid,username:"",postype:2,begintime:"",endtime:""},pickerOptions:{shortcuts:[{text:this.$t("terminal.pickeroptions4"),onClick:function(e){var t=new Date,s=new Date;s.setTime(s.setHours(0,0,0,0)),e.$emit("pick",[s,t])}},{text:this.$t("terminal.pickeroptions5"),onClick:function(e){var t=new Date,s=new Date;s.setTime(s.setHours(0,0,0,0)-1728e5),e.$emit("pick",[s,t])}},{text:this.$t("terminal.pickeroptions6"),onClick:function(e){var t=new Date,s=new Date;s.setTime(s.setHours(0,0,0,0)-5184e5),e.$emit("pick",[s,t])}}]},tasktime:[(new Date).getTime()-(36e5-1),new Date],begingTime:"",endTime:"",locationHisList:"",mapName:"map",arrs:[],map:null,time:"",startTime:"",progress:0,animating:!1,speed:1,now:null,textContent:this.$t("locationoutdoorh.start"),routeCoords:[],TrackData:[],routeLength:null,route:null,routeFeature:null,geoMarker:null,startMarker:null,endMarker:null,styles:{route:new w.e({stroke:new w.d({width:6,color:[0,0,0,.8]})}),icon:new w.e({image:new w.a({radius:7,fill:new w.b({color:"red"}),stroke:new w.d({color:"white",width:2})})}),geoMarker:new w.e({image:new w.c({anchor:[.5,1],src:s("GYsV")})}),start:new w.e({image:new w.c({anchor:[.5,1],src:s("iKYN")})}),end:new w.e({image:new w.c({anchor:[.5,1],src:s("lTml")})})},showTime:!1,textLayers:[],showLine:!1,vectorLayer:null,vectorLayerText:null,center:[],userLoading:!1,userList:[],tboxList:[],allList:[],allOptions:[]}},methods:{updateSize:function(){this.map.updateSize()},searchInfo:function(){var e=this,t=this;""!=this.searchList.username?this.tasktime&&this.tasktime.length>0?(t.begingTime=t.tasktime[0],t.endTime=t.tasktime[1],(t.endTime-t.begingTime)/1e3/60/60/24>7?t.$message({message:this.$t("locationoutdoorh.message1"),type:"warning"}):(t.begingTime=t.begingTime&&""!=t.begingTime?o.a.formatDate.format(new Date(t.begingTime),"yyyy-MM-dd hh:mm:ss"):"",t.endTime=t.endTime&&""!=t.endTime?o.a.formatDate.format(new Date(t.endTime),"yyyy-MM-dd hh:mm:ss"):"",t.begingTime.length>0&&t.endTime.length>0&&(t.begingTime=Date.parse(new Date(t.begingTime))/1e3,t.endTime=Date.parse(new Date(t.endTime))/1e3),this.searchList.begintime=this.begingTime,this.searchList.endtime=this.endTime,Object(l._43)(this.searchList,this.tenantkey_A,this.tenantid_A,this.userName).then(function(s){if(1001==s.code)if(t.routeCoords=[],s.data.list.length>0){t.$message({message:t.$t("buildingmanagement.searchsuccess"),type:"success"});var a=s.data.list.reverse();e.center=[a[0].x,a[0].y],e.map.getView().setCenter(e.center),a.forEach(function(e){t.routeCoords.push([parseFloat(e.x),parseFloat(e.y)])}),t.TrackData=a,t.addLayers()}else t.$message({message:t.$t("buildingmanagement.nodata"),type:"warning"});else t.$message({message:"zh"==t.$store.state.i18n?s.msg:s.enMsg,type:"error"})}))):t.$message({message:this.$t("locationoutdoorh.message2"),type:"warning"}):t.$message({message:this.$t("locationoutdoorh.message"),type:"warning"})},clearBtn:function(){this.searchList={projectid:this.$store.state.projectid,username:"",postype:2,begintime:"",endtime:""},this.tasktime=[(new Date).getTime()-(36e5-1),new Date],this.begingTime="",this.endTime="",this.routeCoords=[],this.addLayers(),this.getMemberNames()},initMaps:function(){var e=this,t=this;setTimeout(function(){e.map=new u.a({target:"map",layers:[new p.a({className:"baseLayerClass",source:t.openlayersSource})],view:new m.a({projection:"EPSG:4326",center:e.center,zoom:15})}),e.map.addControl(new f.a),e.mapClick(),e.addLayers(),e.addLine(e.map)},0)},removeVectorLayer:function(e){e&&this.map.removeLayer(e)},formatDatetime:function(e){if(null==e||0==e)return"";var t=new Date(1e3*parseInt(e)).toUTCString();return this.datetimecut(t)},datetimecut:function(e){if(!e)return"-";function t(e){return e>9?e:"0"+e}var s=new Date(e);return s.getFullYear()+"-"+t(s.getMonth()+1)+"-"+t(s.getDate())+" "+(s.getHours()<10?"0"+s.getHours():s.getHours())+":"+t(s.getMinutes())+":"+t(s.getSeconds())},changeShow:function(){this.addLayers(),"停止"===this.textContent&&this.stop(!1)},addLayers:function(){var e=this,t=this;this.removeVectorLayer(this.vectorLayer),this.removeVectorLayer(this.vectorLayer2);for(var a=this.map.getLayers().getArray(),r=a.length-1;r>0;r--)a[r].getSource().getFeatures()[0].style_&&a[r].getSource().getFeatures()[0].style_.text_&&t.map.removeLayer(a[r]);if(t.textLayers.forEach(function(e){t.map.removeLayer(e)}),t.textLayers=[],t.routeCoords.length>0){t.routeLength=t.routeCoords.length,t.route=new d.a(t.routeCoords);var n=t.TrackData;t.textLayers=[],n.forEach(function(s){var a=new w.e({text:new w.f({textAlign:"center",textBaseline:"middle",font:"bold 13px 微软雅黑",text:t.showTime?t.formatDatetime(s.gpstime):"",fill:new w.b({color:"#587de5"}),stroke:new w.d({color:"#ffcc33",width:3})})}),r=new h.a({geometry:new d.b([s.x,s.y])});r.setStyle(a);var n=new p.b({source:new g.a({features:[r]}),zIndex:9999,style:null});e.showTime&&t.map.addLayer(n),t.textLayers.push(n)}),t.routeFeature=new h.a({type:"route",geometry:t.route}),t.geoMarker=new h.a({type:"geoMarker",geometry:new d.b(t.routeCoords[0])}),t.startMarker=new h.a({type:"start",geometry:new d.b(t.routeCoords[0])}),t.endMarker=new h.a({type:"end",geometry:new d.b(t.routeCoords[t.routeLength-1])}),t.vectorLayer=new p.b({source:new g.a({features:[t.routeFeature,t.startMarker,t.endMarker]}),style:function(e){return t.showLine||"route"!==e.get("type")?t.styles[e.get("type")]:null}}),t.vectorLayer2&&this.map.removeLayer(t.vectorLayer2),t.vectorLayer2=new p.b({source:new g.a({features:[t.geoMarker]}),style:new w.e({image:new w.c({anchor:[.5,.5],scale:.5,src:s("ByXT"),rotateWithView:!0})}),zIndex:1e4}),this.map.addLayer(t.vectorLayer),this.map.addLayer(t.vectorLayer2)}},mapClick:function(){var e=this;this.map.on("click",function(t){var s=e.map.getFeaturesAtPixel(t.pixel);e.map.getEventPixel(t.originalEvent),t.coordinate;s.length})},handlerPlay:function(){0!=this.routeCoords.length&&("停止"===this.textContent?this.stop(!1):this.start())},moveFeature:function(e){var t=e.frameState;if(this.animating){var s=t.time-this.now,a=Math.round(this.speed*s/1e3);if(this.progress=Math.floor(100/this.routeLength*(this.speed*s)/1e3),a>=this.routeLength)return this.progress="100",void this.stop(!0);var r=new d.b(this.routeCoords[a]),n=void 0;a>0&&(n=new d.b(this.routeCoords[a-1]));this.geoMarker.setGeometry(new d.b(r.flatCoordinates)),n&&this.vectorLayer2.getStyle().getImage().setRotation(this._map_p_rotation(r.flatCoordinates,n.flatCoordinates))}this.map.render()},start:function(){this.animating?this.stop(!1):(this.animating=!0,this.textContent=this.$t("locationoutdoorh.stop"),this.now=(new Date).getTime(),this.geoMarker.setStyle(null),this.map.getView().setCenter(this.center),this.vectorLayer.on("postrender",this.moveFeature),this.map.render())},stop:function(e){this.progress=0,this.animating=!1,this.textContent=this.$t("locationoutdoorh.start");var t=e?this.routeCoords[this.routeLength-1]:this.routeCoords[0];this.geoMarker.getGeometry().setCoordinates(t);this.vectorLayer.un("postrender",this.moveFeature)},addLine:function(e){var t=new w.e({stroke:new w.d({color:"#AA8DC6",width:10})}),s=new d.a([[122.9272781486751,23.848426854398152],[122.40150850225844,22.133416341086654],[121.78811058143899,21.35728019637634],[120.18576499235964,19.5296047588327],[119.25521102926318,17.337282710181967],[119.05017371536066,14.734886033725882],[118.98708531108292,12.810689703255191],[118.07230344905598,10.88649337278446],[116.57395384745995,8.96229704231377],[111.37587218970845,3.8613280294327694],[110.27425959721639,2.809788736599442],[107.95320447327722,5.7617448175673145],[107.26213818712276,7.806878264206475],[108.44658415967254,8.693401446500248],[110.07396639858125,11.021809880631187],[110.90017584295029,13.225035065615302],[109.69841665114078,15.428260250599415],[107.99592446274401,17.531338836266087]]),a=new g.a({wrapX:!1}),r=new w.e({stroke:new w.d({color:[170,141,198,1],lineDash:[2,7]})});var n=new h.a({geometry:s,finished:!1,dashOffset:-8});function i(){return[r,new w.e({stroke:new w.d({color:[170,141,198,1],widht:5,lineDash:[2,7],lineDashOffset:n.get("dashOffset")})})]}n.setStyle(i()),a.addFeature(n);var o=new p.b({source:a,style:t});e.addLayer(o),setInterval(function(){var e=n.get("dashOffset");e=0==e?-8:e+1,n.set("dashOffset",e),n.setStyle(i())},100)},delFeature:function(e){for(var t=this.map.getLayers().getArray(),s=1;s<t.length;s++);},_map_p_rotation:function(e,t){return Math.atan2(1,0)-Math.atan2(e[1]-t[1],e[0]-t[0])},getAllFeatures:function(){var e=this.map.getLayers().getArray();this.arrs=[];for(var t=1;t<e.length;t++);},getMemberNames:function(){var e=this,t=this,s={projectid:this.$store.state.projectid};Object(l._68)(s,this.tenantkey_A,this.tenantid_A,this.userName).then(function(s){if(1001==s.code){t.userList=s.data.map(function(e){return{value:""+e.maplabel,maplabel:""+e.maplabel,username:""+e.username}});for(var a=t.userList.length-1;a>-1;a--)""!=t.userList[a].maplabel&&null!=t.userList[a].maplabel&&void 0!=t.userList[a].maplabel||t.userList.splice(a,1);e.getTboxSnIds()}})},getTboxSnIds:function(){var e=this,t={projectid:this.$store.state.projectid};Object(l._95)(t,this.tenantkey_A,this.tenantid_A,this.userName).then(function(t){1001==t.code&&(e.tboxList=t.data.filter(function(e){return e.maplabel}).map(function(e){return{value:""+e.maplabel,maplabel:""+e.maplabel,username:""+e.sn}}),e.allList=e.userList.concat(e.tboxList))})},remoteUserMethod:function(e){var t=this;""!==e?(this.userLoading=!0,setTimeout(function(){t.userLoading=!1,t.allOptions=t.allList.filter(function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>-1?t.value.toLowerCase().indexOf(e.toLowerCase())>-1:t.username.toLowerCase().indexOf(e.toLowerCase())>-1?t.username.toLowerCase().indexOf(e.toLowerCase())>-1:void 0})},200)):this.allOptions=[]}},computed:{show1:function(){return this.$store.state.show}},watch:{show1:function(e){var t=this;setTimeout(function(){t.msg=2,t.getMsgSum()},1e3)},"$i18n.locale":function(){r()(this.$data,this.$options.data.apply(this))}},beforeMount:function(){this.$store.state.longis&&this.$store.state.latis?this.center=[this.$store.state.longis,this.$store.state.latis]:"zh"==this.$store.state.i18n?this.center=[118,32]:this.center=[.1,51.3],"zh"==this.$store.state.i18n?this.openlayersSource=new c.b({url:"https://www.edwei.cn:8443/osm/{z}/{x}/{y}.png",crossOrigin:""}):this.openlayersSource=new c.b,this.getMemberNames(),this.initMaps(),this.getMemberNames()}},v={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[s("div",{staticClass:"inputContent"},[s("el-form",{staticClass:"demo-form-inline",staticStyle:{display:"flex","white-space":"nowrap","margin-left":"0%"},attrs:{model:e.searchList}},[s("el-form-item",{staticStyle:{display:"flex","margin-left":"0%","margin-right":"2%"},attrs:{label:e.$t("locationoutdoorh.name")}},[s("el-select",{attrs:{clearable:"",filterable:"",remote:"","allow-create":"","remote-method":e.remoteUserMethod,placeholder:e.$t("locationoutdoorh.text"),loading:e.userLoading},model:{value:e.searchList.username,callback:function(t){e.$set(e.searchList,"username",t)},expression:"searchList.username"}},e._l(e.allOptions,function(t){return s("el-option",{key:t.maplabel,attrs:{label:t.username,value:t.username}},[s("span",{staticStyle:{float:"left"}},[e._v(e._s(t.username))]),e._v(" "),s("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.maplabel))])])}),1)],1),e._v(" "),s("el-form-item",{staticStyle:{display:"flex","margin-left":"2%","margin-right":"0"},attrs:{label:e.$t("locationoutdoorh.time")}},[s("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":e.$t("locationoutdoorh.to"),"start-placeholder":e.$t("locationoutdoorh.starttime"),"end-placeholder":e.$t("locationoutdoorh.endtime")},model:{value:e.tasktime,callback:function(t){e.tasktime=t},expression:"tasktime"}})],1),e._v(" "),s("el-form-item",{staticStyle:{display:"flex","margin-left":"2%"}},[s("el-button",{staticClass:"query",attrs:{type:"primary"},on:{click:function(t){return e.searchInfo()}}},[e._v(e._s(e.$t("locationoutdoorh.search")))]),e._v(" "),s("el-button",{staticClass:"reset",attrs:{type:"primary"},on:{click:function(t){return e.clearBtn()}}},[e._v(e._s(e.$t("locationoutdoorh.reset")))])],1),e._v(" "),s("el-form-item",{staticStyle:{display:"block",width:"35%","margin-left":"0%"},attrs:{label:e.$t("locationoutdoorh.speed")}},[s("div",{staticClass:"block"},[s("div",{staticStyle:{width:"80%"}},[s("el-slider",{attrs:{step:1,max:10,min:1},model:{value:e.speed,callback:function(t){e.speed=t},expression:"speed"}})],1),e._v(" "),s("el-button",{staticClass:"start",attrs:{type:"primary",plain:""},on:{click:e.handlerPlay}},[e._v(e._s(e.textContent))]),s("el-checkbox",{staticClass:"showline",attrs:{disabled:e.showTime},on:{change:function(t){return e.changeShow()}},model:{value:e.showLine,callback:function(t){e.showLine=t},expression:"showLine"}},[e._v(e._s(e.$t("locationoutdoorh.showline")))]),e._v(" "),s("el-checkbox",{attrs:{disabled:!e.showLine},on:{change:function(t){return e.changeShow()}},model:{value:e.showTime,callback:function(t){e.showTime=t},expression:"showTime"}},[e._v(e._s(e.$t("locationoutdoorh.showtime")))])],1)])],1)],1),e._v(" "),e._m(0)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"mapConent"},[t("div",{attrs:{id:"map"}})])}]};var L=s("VU/8")(y,v,!1,function(e){s("AMav")},"data-v-30d2d5c6",null);t.default=L.exports},AMav:function(e,t){},ByXT:function(e,t,s){e.exports=s.p+"static/img/user2.b089880.png"}});