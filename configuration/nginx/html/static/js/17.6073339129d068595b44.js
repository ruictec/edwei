webpackJsonp([17],{RMXQ:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=r("PO8r"),a=r("CTnB"),i=r("s0MJ"),s=r("c2Ch"),u=r("WiOa"),c=(r("ktr9"),r("nq2H")),h=r("trid"),p=r("Lfyu"),l=r("5MGX"),m=r("grfP"),d=r("xno4"),f=r("NBiL"),g=r("3ciB"),y=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});function v(e){return"string"==typeof e?e:""}var w=function(e){function t(){return e.call(this)||this}return y(t,e),t.prototype.getType=function(){return f.a.TEXT},t.prototype.readFeature=function(e,t){return this.readFeatureFromText(v(e),this.adaptOptions(t))},t.prototype.readFeatureFromText=function(e,t){return Object(g.b)()},t.prototype.readFeatures=function(e,t){return this.readFeaturesFromText(v(e),this.adaptOptions(t))},t.prototype.readFeaturesFromText=function(e,t){return Object(g.b)()},t.prototype.readGeometry=function(e,t){return this.readGeometryFromText(v(e),this.adaptOptions(t))},t.prototype.readGeometryFromText=function(e,t){return Object(g.b)()},t.prototype.readProjection=function(e){return this.readProjectionFromText(v(e))},t.prototype.readProjectionFromText=function(e){return this.dataProjection},t.prototype.writeFeature=function(e,t){return this.writeFeatureText(e,this.adaptOptions(t))},t.prototype.writeFeatureText=function(e,t){return Object(g.b)()},t.prototype.writeFeatures=function(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))},t.prototype.writeFeaturesText=function(e,t){return Object(g.b)()},t.prototype.writeGeometry=function(e,t){return this.writeGeometryText(e,this.adaptOptions(t))},t.prototype.writeGeometryText=function(e,t){return Object(g.b)()},t}(d.a),b=r("OEyb");function T(e,t,r,n,o,a){var i,s;void 0!==o?(i=o,s=void 0!==a?a:0):(i=[],s=0);for(var u=t;u<r;){var c=e[u++];i[s++]=e[u++],i[s++]=c;for(var h=2;h<n;++h)i[s++]=e[u++]}return i.length=s,i}var L=r("yGLh"),k=r("VgFP"),O=r("wupX"),x=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function A(e){for(var t,r="";e>=32;)t=63+(32|31&e),r+=String.fromCharCode(t),e>>=5;return t=e+63,r+=String.fromCharCode(t)}!function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.dataProjection=Object(L.g)("EPSG:4326"),r.factor_=n.factor?n.factor:1e5,r.geometryLayout_=n.geometryLayout?n.geometryLayout:l.a.XY,r}x(t,e),t.prototype.readFeatureFromText=function(e,t){var r=this.readGeometryFromText(e,t);return new c.a(r)},t.prototype.readFeaturesFromText=function(e,t){return[this.readFeatureFromText(e,t)]},t.prototype.readGeometryFromText=function(e,t){var r=Object(k.b)(this.geometryLayout_),n=function(e,t,r){var n,o=r||1e5,a=new Array(t);for(n=0;n<t;++n)a[n]=0;for(var i=function(e,t){for(var r=t||1e5,n=function(e){for(var t=function(e){for(var t=[],r=0,n=0,o=0,a=e.length;o<a;++o){var i=e.charCodeAt(o)-63;r|=(31&i)<<n,i<32?(t.push(r),r=0,n=0):n+=5}return t}(e),r=0,n=t.length;r<n;++r){var o=t[r];t[r]=1&o?~(o>>1):o>>1}return t}(e),o=0,a=n.length;o<a;++o)n[o]/=r;return n}(e,o),s=0,u=i.length;s<u;)for(n=0;n<t;++n,++s)a[n]+=i[s],i[s]=a[n];return i}(e,r,this.factor_);T(n,0,n.length,r,n);var o=Object(O.a)(n,0,n.length,r),a=new m.a(o,this.geometryLayout_);return Object(d.b)(a,!1,this.adaptOptions(t))},t.prototype.writeFeatureText=function(e,t){var r=e.getGeometry();return r?this.writeGeometryText(r,t):(Object(b.a)(!1,40),"")},t.prototype.writeFeaturesText=function(e,t){return this.writeFeatureText(e[0],t)},t.prototype.writeGeometryText=function(e,t){var r=(e=Object(d.b)(e,!0,this.adaptOptions(t))).getFlatCoordinates(),n=e.getStride();return T(r,0,r.length,n,r),function(e,t,r){var n,o=r||1e5,a=new Array(t);for(n=0;n<t;++n)a[n]=0;for(var i=0,s=e.length;i<s;)for(n=0;n<t;++n,++i){var u=e[i],c=u-a[n];a[n]=u,e[i]=c}return function(e,t){for(var r=t||1e5,n=0,o=e.length;n<o;++n)e[n]=Math.round(e[n]*r);return function(e){for(var t=0,r=e.length;t<r;++t){var n=e[t];e[t]=n<0?~(n<<1):n<<1}return function(e){for(var t="",r=0,n=e.length;r<n;++r)t+=A(e[r]);return t}(e)}(e)}(e,o)}(r,n,this.factor_)}}(w);var C=r("lVyT"),F=r("ItK/"),_=(r("irp0"),r("WMwB")),M=r("0Fy/"),j=r("beD/"),$=r("Bupa"),D={components:{Menu:o.a,Project:a.a},name:"LocationHistorical3D",data:function(){return{openlayersSource:"",contrForPrionum:this.$store.state.userInfo.prionum,tenantid_A:this.$store.state.userInfo.tenantid,tenantkey_A:this.$store.state.userInfo.tenantkey,userName:this.$store.state.userInfo.username,intoProjectType:this.$store.state.intoProjectType,userList:[],searchList:{projectid:this.$store.state.projectid,devtype:"",postype:2,begintime:"",endtime:""},pickerOptions:{shortcuts:[{message:this.$t("terminal.pickeroptions4"),onClick:function(e){var t=new Date,r=new Date;r.setTime(r.setHours(0,0,0,0)),e.$emit("pick",[r,t])}},{message:this.$t("terminal.pickeroptions5"),onClick:function(e){var t=new Date,r=new Date;r.setTime(r.setHours(0,0,0,0)-1728e5),e.$emit("pick",[r,t])}},{message:this.$t("terminal.pickeroptions6"),onClick:function(e){var t=new Date,r=new Date;r.setTime(r.setHours(0,0,0,0)-5184e5),e.$emit("pick",[r,t])}}]},tasktime:[(new Date).getTime()-(36e5-1),new Date],begingTime:"",endTime:"",locationHisList:"",mapName:"map",arrs:[],map:null,time:"",startTime:"",progress:0,animating:!1,speed:null,now:null,textContent:"开始回放",routeCoords:[],routeLength:null,route:null,routeFeature:null,geoMarker:null,startMarker:null,endMarker:null,styles:{route:new j.e({stroke:new j.d({width:6,color:[237,212,0,.8]})}),icon:new j.e({image:new j.a({radius:7,fill:new j.b({color:"red"}),stroke:new j.d({color:"white",width:2})})}),geoMarker:new j.e({image:new j.c({anchor:[.5,1],src:r("TNTR")})}),start:new j.e({image:new j.c({anchor:[.5,1],src:r("TNTR")})}),end:new j.e({image:new j.c({anchor:[.5,1],src:r("TNTR")})})},vectorLayer:null,center:[],userLoading:!1,userOptions:[]}},methods:{searchInfo:function(){var e=this,t=this;if(""!=this.searchList.deveui){if(this.tasktime&&this.tasktime.length>0){if(t.begingTime=t.tasktime[0],t.endTime=t.tasktime[1],(t.endTime-t.begingTime)/1e3/60/60/24>7)return void t.$message({message:this.$t("tet.tet1"),type:"warning"});t.begingTime=t.begingTime&&""!=t.begingTime?i.a.formatDate.format(new Date(t.begingTime),"yyyy-MM-dd hh:mm:ss"):"",t.endTime=t.endTime&&""!=t.endTime?i.a.formatDate.format(new Date(t.endTime),"yyyy-MM-dd hh:mm:ss"):"",t.begingTime.length>0&&t.endTime.length>0&&(t.begingTime=Date.parse(new Date(t.begingTime))/1e3,t.endTime=Date.parse(new Date(t.endTime))/1e3),this.searchList.begintime=this.begingTime,this.searchList.endtime=this.endTime,1==this.intoProjectType?this.searchList.devtype=1:2==this.intoProjectType&&(this.searchList.devtype=2),Object(s._43)(this.searchList,this.tenantkey_A,this.tenantid_A,this.userName).then(function(r){if(1001==r.code)if(r.data.list.length>0){t.$message({message:e.$t("beacon.searchsuccess"),type:"success"});var n=r.data.list;e.center=[n[0].x,n[0].y],n.forEach(function(e){t.routeCoords.push([parseFloat(e.x),parseFloat(e.y)])}),t.addLayers()}else t.$message({message:e.$t("beacon.nodata"),type:"warning"});else t.$message({message:"zh"==t.$store.state.i18n?r.msg:r.enMsg,type:"error"})})}}else this.$message({message:this.$t("tet.tet3"),type:"warning"})},clearBtn:function(){this.searchList={projectid:this.$store.state.projectid,devtype:"",postype:2,begintime:"",endtime:""},this.tasktime=[],this.begingTime="",this.endTime="",this.routeCoords=[],this.addLayers()},initMaps:function(){var e=this,t=this;setTimeout(function(){e.map=new h.a({target:"map",layers:[new F.a({source:t.openlayersSource})],view:new p.a({projection:"EPSG:4326",center:e.center,zoom:15})}),e.map.addControl(new M.a),e.mapClick(),e.addLayers(),e.addLine(e.map)},0)},removeVectorLayer:function(e){e&&this.map.removeLayer(e)},addLayers:function(){this.removeVectorLayer(this.vectorLayer);var e=this;e.routeCoords.length>0&&(e.routeLength=e.routeCoords.length,e.route=new C.a(e.routeCoords),e.routeFeature=new c.a({type:"route",geometry:e.route}),e.geoMarker=new c.a({type:"geoMarker",geometry:new C.b(e.routeCoords[0])}),e.startMarker=new c.a({type:"start",geometry:new C.b(e.routeCoords[0])}),e.endMarker=new c.a({type:"end",geometry:new C.b(e.routeCoords[e.routeLength-1])}),e.vectorLayer=new F.b({source:new _.a({features:[e.routeFeature,e.geoMarker,e.startMarker,e.endMarker]}),style:function(t){return e.animating&&"geoMarker"===t.get("type")?null:e.styles[t.get("type")]}}),this.map.addLayer(e.vectorLayer))},mapClick:function(){var e=this;this.map.on("click",function(t){var r=e.map.getFeaturesAtPixel(t.pixel);e.map.getEventPixel(t.originalEvent),t.coordinate;r.length})},handlerPlay:function(){"停止回放"===this.textContent?this.stop(!1):this.start()},moveFeature:function(e){var t=Object($.a)(e),r=e.frameState;if(this.animating){var n=r.time-this.now,o=Math.round(this.speed*n/1e3);if(this.progress=Math.floor(100/this.routeLength*(this.speed*n)/1e3),o>=this.routeLength)return this.progress="100",void this.stop(!0);var a=new C.b(this.routeCoords[o]),i=new c.a(a);t.drawFeature(i,this.styles.geoMarker)}this.map.render()},start:function(){if(this.animating)this.stop(!1);else{this.animating=!0,this.textContent="停止回放",this.now=(new Date).getTime();var e=document.getElementById("speed");this.speed=e.value,this.geoMarker.setStyle(null),this.map.getView().setCenter(this.center),this.vectorLayer.on("postrender",this.moveFeature),this.map.render()}},stop:function(e){this.progress=0,this.animating=!1,this.textContent="开始回放";var t=e?this.routeCoords[this.routeLength-1]:this.routeCoords[0];this.geoMarker.getGeometry().setCoordinates(t);this.vectorLayer.un("postrender",this.moveFeature)},addLine:function(e){var t=new j.e({stroke:new j.d({color:"#AA8DC6",width:10})}),r=new C.a([[122.9272781486751,23.848426854398152],[122.40150850225844,22.133416341086654],[121.78811058143899,21.35728019637634],[120.18576499235964,19.5296047588327],[119.25521102926318,17.337282710181967],[119.05017371536066,14.734886033725882],[118.98708531108292,12.810689703255191],[118.07230344905598,10.88649337278446],[116.57395384745995,8.96229704231377],[111.37587218970845,3.8613280294327694],[110.27425959721639,2.809788736599442],[107.95320447327722,5.7617448175673145],[107.26213818712276,7.806878264206475],[108.44658415967254,8.693401446500248],[110.07396639858125,11.021809880631187],[110.90017584295029,13.225035065615302],[109.69841665114078,15.428260250599415],[107.99592446274401,17.531338836266087]]),n=new _.a({wrapX:!1}),o=new j.e({stroke:new j.d({color:[170,141,198,1],lineDash:[2,7]})});var a=new c.a({geometry:r,finished:!1,dashOffset:-8});function i(){return[o,new j.e({stroke:new j.d({color:[170,141,198,1],widht:5,lineDash:[2,7],lineDashOffset:a.get("dashOffset")})})]}a.setStyle(i()),n.addFeature(a);var s=new F.b({source:n,style:t});e.addLayer(s),setInterval(function(){var e=a.get("dashOffset");e=0==e?-8:e+1,a.set("dashOffset",e),a.setStyle(i())},100)},delFeature:function(e){for(var t=this,r=this.map.getLayers().getArray(),n=function(n){e.deveui==r[n].getSource().getFeatures()[0].values_.deveui&&(r[n].getSource().getFeatures().forEach(function(e){r[n].getSource().removeFeature(e)}),t.map.removeLayer(r[n]))},o=1;o<r.length;o++)n(o)},getAllFeatures:function(){var e=this.map.getLayers().getArray();this.arrs=[];for(var t=1;t<e.length;t++);},getMemberNames:function(){var e=this,t={projectid:this.$store.state.projectid};Object(s._68)(t,this.tenantkey_A,this.tenantid_A,this.userName).then(function(t){if(1001==t.code){e.userList=t.data.map(function(e){return{value:""+e.maplabel,maplabel:""+e.maplabel,username:""+e.username}});for(var r=e.userList.length-1;r>-1;r--)""!=e.userList[r].maplabel&&null!=e.userList[r].maplabel&&void 0!=e.userList[r].maplabel||e.userList.splice(r,1)}})},remoteUserMethod:function(e){var t=this;""!==e?(this.userLoading=!0,setTimeout(function(){t.userLoading=!1,t.userOptions=t.userList.filter(function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>-1?t.value.toLowerCase().indexOf(e.toLowerCase())>-1:t.username.toLowerCase().indexOf(e.toLowerCase())>-1?t.username.toLowerCase().indexOf(e.toLowerCase())>-1:void 0})},200)):this.userOptions=[]}},beforeMount:function(){this.$store.state.longis&&this.$store.state.latis?this.center=[this.$store.state.longis,this.$store.state.latis]:"zh"==this.$store.state.i18n?this.center=[118,32]:this.center=[.1,51.3],"zh"==this.$store.state.i18n?this.openlayersSource=new u.b({url:"https://www.edwei.cn:8443/osm/{z}/{x}/{y}.png",crossOrigin:""}):this.openlayersSource=new u.b,this.getMemberNames(),this.initMaps()}},S={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content"},[r("div",{staticClass:"inputContent"},[r("el-form",{staticClass:"demo-form-inline",staticStyle:{display:"flex","white-space":"nowrap","margin-left":"1%"},attrs:{model:e.searchList}},[r("el-form-item",{staticStyle:{display:"flex","margin-left":"1%","margin-right":"2%"},attrs:{label:e.$t("checkwork.Name")}},[r("el-select",{staticStyle:{width:"120%"},attrs:{clearable:"",filterable:"",remote:"","remote-method":e.remoteUserMethod,placeholder:e.$t("locationoutdoorh.text")},model:{value:e.searchList.deveui,callback:function(t){e.$set(e.searchList,"deveui",t)},expression:"searchList.deveui"}},e._l(e.userOptions,function(t){return r("el-option",{key:t.maplabel,attrs:{label:t.username,value:t.maplabel}},[r("span",{staticStyle:{float:"left"}},[e._v(e._s(t.username))]),e._v(" "),r("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.maplabel))])])}),1)],1),e._v(" "),r("el-form-item",{staticStyle:{display:"flex","margin-left":"2%","margin-right":"0"},attrs:{label:e.$t("locationoutdoorh.time")}},[r("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":e.$t("locationoutdoorh.to"),"start-placeholder":e.$t("locationoutdoorh.starttime"),"end-placeholder":e.$t("locationoutdoorh.endtime")},model:{value:e.tasktime,callback:function(t){e.tasktime=t},expression:"tasktime"}})],1),e._v(" "),r("el-form-item",{staticStyle:{display:"flex","margin-left":"2%"}},[r("el-button",{staticClass:"query",attrs:{type:"primary"},on:{click:function(t){return e.searchInfo()}}},[e._v(e._s(e.$t("locationoutdoorh.search")))]),e._v(" "),r("el-button",{staticClass:"reset",attrs:{type:"primary"},on:{click:function(t){return e.clearBtn()}}},[e._v(e._s(e.$t("locationoutdoorh.reset")))])],1)],1)],1),e._v(" "),r("div",{staticClass:"mapConent"},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:3}},[r("label",{attrs:{for:"speed"}},[e._v("\n          "+e._s(e.$t("tet.Movementspeed"))+": \n          "),r("input",{attrs:{id:"speed",type:"range",step:"10",value:"5"}})])]),e._v(" "),r("el-col",{attrs:{span:1}},[r("el-button",{attrs:{type:"primary",plain:""},on:{click:e.handlerPlay}},[e._v(e._s(e.textContent))])],1)],1),e._v(" "),r("div",{attrs:{id:"map"}})],1)])},staticRenderFns:[]};var P=r("VU/8")(D,S,!1,function(e){r("bmsC")},"data-v-bfb3f3e6",null);t.default=P.exports},TNTR:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB9ElEQVRYhcWXzS4DURTH//PRWREaVBphQepjI+JjZecBbHiAvoIn8QoegI2FJRthIUSIkDTVIKj6qu92Ombk1NUwOvfOHR3z382cc3p+99x7pvco+KbLgtkBYA7ANIAUAAONkQkgA2AZwHwyYVx//WoN4LJgzgBYANDUoKReegaQTiaMpRoAS74YcmK3ZglCYWU//oeVu0WV6FXZnv93crCccyo7cFFpmrag3MDTLitTD5L8puhgN2OhcO9UnxNxBSMpHe2tijDWJYMq4MhEZM9trG5XYNs/36sqMDUWQ1+XKkUg5f3y5mBt53dyEr0jG/mEBpA5s/H+7m0nG/mEBlB8Fq/Oj09gACMm9onpUvnlALo7xe49PnyCAyRULgTZ/EAGBiCND2rQtPq2thYFJbmuhu/vALXZxr6FgxynDdg5mRzW0d/tQRkEgNprZbOCixv/LTYxpGN0QAzhawvW9yyp5KStQwu5C3GMECB/a+PohF92LxG4JQgVAuxngyUnvZYcZM/58VwAxwFOr+RK79Zpnh/PBXh6dYQlFOnukX/GuQAV62/JSeUK385tQ1r9g+Sfi1t0T4g3e19UdDY01L0V6drn1y1EmSqbWKJSRmXjUlRajn4wYYNiOoIK0Hx4XW1DNijOMqqwRTmqcyE9RDueA/gAlKTAZXOPVYMAAAAASUVORK5CYII="},bmsC:function(e,t){}});